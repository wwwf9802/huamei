<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>工地异常</title>
		<!-- Mobile Devices Support @begin -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta content="telephone=no,email=no" name="format-detection">
		<script src="../js/flexible.js" type="text/javascript"></script>
		<script src="../js/flexible_css.js" type="text/javascript"></script>
		<!-- Mobile Devices Support @end -->
		<link rel="stylesheet" href="../css/base-reset.css">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../css/swiper-3.3.1.min.css">
		<link rel="stylesheet" type="text/css" href="../css/common.css">
		<link rel="stylesheet" type="text/css" href="../css/lzr.css">
	</head>
	<style>
		.errorAppoint .selectItem {
			height: 1.373rem;
			line-height: 1.373rem;
			font-size: 0.4rem;
			color: #eb6d00;
			position: relative;
			background-color: #fff;
		}
		
		.errorAppoint .selectItem i {
			background: url(../images/icon-jiantou.png) no-repeat;
			position: absolute;
			right: 0.15rem;
			top: 0.42rem;
			display: block;
			width: 0.5rem;
			height: 0.5rem;
			background-size: contain;
		}
		
		.errorAppoint .selectItem .title {
			color: #999;
			width: 3rem;
			margin-left: 0.5rem;
		}
		
		.errorAppoint .selectItem .item {
			width: 3rem;
			text-align: right;
			margin-right: 1rem;
			color: black;
		}
		
		.errorAppoint .selectItem.des .item {
			font-size: 0.3rem;
			color: #b2b2b2;
		}
		
		.errorAppoint .selectItem.des {
			border-top: 1px solid #eee;
		}
		
		.errorAppoint textarea {
			width: 100%;
			height: 3rem;
			background-color: #F9F9F9;
			border-radius: 0;
			border: none;
		}
		
		.errorAppoint .btn-div {
			height: 11rem;
			width: 100%;
			background-color: #f9f9f9;
			position: fixed;
			bottom: 0px;
			left: 0px;
			text-align: center;
			padding-top: 3rem;
		}
		
		.errorAppoint .btn-div .btn {
			background-color: #FB8F32;
			color: rgba(255, 255, 255, 0.6);
			padding: 0.4rem 2.4rem;
			font-size: 0.5rem;
		}
	</style>

	<body class="errorAppoint">
		<div class="mui-bar mui-bar-nav header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<span class="title">异常任务指派</span>
		</div>
		<div class="g-content-sale mui-content g-content-news-list g-paigong g-gongdi-yichang ">
			<div class="selectItem">
				<div class="title left">
					图纸名称
				</div>
				<div id="selectProduct" class="item right">
					点击选择
				</div>
				<i></i>
			</div>
			<div class="selectItem des">
				<div class="title left">
					图纸名称
				</div>
				<div class="item right">
					默认为不合格项目
				</div>
			</div>
			<textarea id="txt"></textarea>
			<div class="btn-div">
				<span id="sure" class="btn">申请</span>
			</div>
		</div>

		<script src="../js/zepto1.1.6.min.js" type="text/javascript"></script>
		<script src='../js/swiper-3.3.1.min.js' type="text/javascript"></script>
		<script src='../js/mui.min.js'></script>
		<script src="../js/public.js"></script>
		<script type="text/javascript" src="../js/global.js"></script>
		<script type="text/javascript" src="../js/vue.min.js"></script>
		<script>
			var item = JSON.parse(localStorage.errorItem);
			$("#txt").val(item.content);

			init();

			function init() {
				mui.ajax(getBaseServerUrl() + '/app/sitesEmp/findSitesEmpList', {
					type: 'get', 
					data: {
						sitesRecordId: localStorage.selectSitesId
					},
					success: function(jsonData) {
						console.log(JSON.stringify(jsonData));
					},
					error: function() {
						console.log(1111111);
					}
				});
			}

			sure.addEventListener('tap', function() {
				mui.ajax({
					url: getBaseServerUrl() + '/sites/sitesTask/saveExceptionClose',
					dataType: 'json',
					contentType: "application/json",
					data: JSON.stringify({
						"taskName": "",
						"taskTime": "",
						"stagesName": "",
						"lastTaskId": item.lastTaskId,
						"empId": "1",
						"remark": $("#txt").val(),
						"fromName": '1'
					}),
					type: 'post',
					success: function(jsonData) {
						if(jsonData.status) {
							init();
						}
						plus.nativeUI.alert(jsonData.msg);
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {}
				});
			}, false);
		</script>
	</body>

</html>